<div class="editar-agenda-container">
  <div class="header">
    <h2>Editar Agenda del Dr. {{ data.nombre_medico }}</h2>
    <button mat-icon-button (click)="cerrarPanel()" aria-label="Cerrar">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- SECCIÓN HORARIOS -->
  <section class="agenda-section">
    <h2>Horarios ({{ data.fecha | date:'shortDate' }})</h2>

    <form [formGroup]="agendaForm">
      <div formArrayName="horarios" class="horarios-container">
        <div *ngFor="let horario of horarios.controls; let i = index" [formGroupName]="i"
          class="horario-row mat-elevation-z2">
          <mat-form-field appearance="outline" class="time-field">
            <mat-label>Hora de entrada</mat-label>
            <input matInput [ngxTimepicker]="entradaPicker" formControlName="horaEntrada" readonly [format]="24" />
            <ngx-material-timepicker-toggle matSuffix [for]="entradaPicker"></ngx-material-timepicker-toggle>
            <ngx-material-timepicker #entradaPicker></ngx-material-timepicker>
          </mat-form-field>

          <mat-form-field appearance="outline" class="time-field">
            <mat-label>Hora de salida</mat-label>
            <input matInput [ngxTimepicker]="salidaPicker" formControlName="horaSalida" readonly [format]="24" />
            <ngx-material-timepicker-toggle matSuffix [for]="salidaPicker"></ngx-material-timepicker-toggle>
            <ngx-material-timepicker #salidaPicker></ngx-material-timepicker>
          </mat-form-field>

          <button mat-icon-button color="warn" (click)="eliminarHorario(i)" matTooltip="Eliminar rango">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </form>

    <div class="agenda-actions">
      <button mat-stroked-button color="primary" (click)="agregarHorario()">
        <mat-icon>add</mat-icon> Agregar horario
      </button>
      <button mat-flat-button color="primary" (click)="guardarAgenda()">
        <mat-icon>save</mat-icon> Guardar cambios
      </button>
    </div>
  </section>

  <mat-divider></mat-divider>

  <!-- TURNOS -->
  <section class="turnos-section">
       
    <div class="turnos-header">
      <h2>Turnos Confirmados</h2>

    </div>

        <table mat-table [dataSource]="turnos" class="mat-elevation-z4 full-width-table">
                  <ng-container matColumnDef="hora">
                <th mat-header-cell *matHeaderCellDef>Hora</th>
                <td mat-cell *matCellDef="let t">{{ t.hora }}</td>
              </ng-container>

            <ng-container matColumnDef="paciente">
                <th mat-header-cell *matHeaderCellDef>Paciente</th>
                <td mat-cell *matCellDef="let t">{{ t.nombre_paciente }}</td>
              </ng-container>

            <ng-container matColumnDef="cobertura">
                <th mat-header-cell *matHeaderCellDef>Cobertura</th>
                <td mat-cell *matCellDef="let t">{{ t.cobertura }}</td>
              </ng-container>

            <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                <td mat-cell *matCellDef="let t">
                    <button mat-icon-button color="warn" (click)="eliminarTurno(t.id_turno)"
            matTooltip="Eliminar turno">
                        <mat-icon>delete</mat-icon>
                      </button>
                  </td>
              </ng-container>

            <tr mat-header-row *matHeaderRowDef="['hora','paciente','cobertura','acciones']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['hora','paciente','cobertura','acciones']"></tr>
          </table>

        <p *ngIf="turnos.length === 0" class="no-turnos">
            No hay turnos para este día.
          </p>

    <div class="agenda-actions">
      <button mat-flat-button color="primary" (click)="abrirCrearTurno()">
        <mat-icon>add</mat-icon> Asignar Turno
      </button>
    </div>
     
  </section>
</div>